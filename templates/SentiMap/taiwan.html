{% extends "entry/base.html"  %}
{% load staticfiles %}

{% block eachStyle %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
<link rel="stylesheet" href="{% static 'SentiMap/css/map.css' %}" />
<style type="text/css">
  #windyty {    height: 500px; width: 1000px; 
                margin-left: auto; margin-right: auto;
                position: relative;
                margin-top: 50px; }
</style>
{% endblock %}

{% block leftBar %}
	{% include "SentiMap/extendEntry/leftBar.html" %}
{% endblock %}

{% block topBar %}
	{% include "SentiMap/extendEntry/topBar.html" %}
{% endblock %}


{% block content %}
<div id="windyty"></div>

    <p>Displayed parameters:<span id="state"></span></p>
    <p>Overlays: <span id="overlays"> <a>wind</a> <a>temp</a> <a>pressure</a> <a>clouds</a> <a>rh</a> <a>gust</a> <a>lclouds</a> <a>waves</a> <a>swell</a> <a>wwaves</a> <a>swellperiod</a> <a>sst</a> <a>sstanom</a> <a>currents</a> </span></p>

    <p>Levels: <span id="levels"><a>surface</a> <a>975h</a> <a>950h</a> <a>925h</a> <a>900h</a> <a>850h</a> <a>750h</a> <a>700h</a> <a>550h</a> <a>450h</a> <a>350h</a> <a>300h</a> <a>250h</a> <a>200h</a> <a>150h</a> </span></p>
    <br />
{% endblock %}

{% block jsblock %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.5/leaflet.js"></script>

<!--MapName是從view傳過來的地圖名稱變數 with可以讓我們在template做變數的儲存 add可以串接字串-->
<script src="
{% with js_static='SentiMap/js/'|add:MapName %}
	{% static js_static %}
{% endwith %}
" type="text/javascript"></script>

<script>
	var windytyInit = {
        key: 'PsL-At-XpsPTZexBwUkO7Mx5I',
        lat: 23.5, lon: 121, zoom: 7,
      }  

      function windytyMain(map) {

        // html elements
        var 
        overlays = document.getElementById('overlays'),
        levels = document.getElementById('levels'),
        state = document.getElementById('state');

        // Handle change of overlay
        overlays.onclick = function(event) {
            W.setOverlay(event.target.innerHTML)
        }  

        // Handle change of level
        levels.onclick = function(event) {
            W.setLevel(event.target.innerHTML);
        }

        // Display actual state of a map
        W.on('redrawFinished',function( displayedParams ) {
          state.innerHTML = displayedParams.overlay + ', ' + displayedParams.level;
        })
    	// var map = L.map('map').setView([37.8, -96], 4);
    	var cities = new L.LayerGroup();

    	L.marker([24.06, 120.40]).bindPopup('This is Littleton, CO.').addTo(cities),
    	L.marker([24.066, 120.45]).bindPopup('This is Denver, CO.').addTo(cities),
    	L.marker([24.07, 120.48]).bindPopup('This is Aurora, CO.').addTo(cities),
    	L.marker([24.075, 120.499]).bindPopup('This is Golden, CO.').addTo(cities);


    	var mbAttr = 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
    			'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
    			'Imagery © <a href="http://mapbox.com">Mapbox</a>',
    		mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw';

    	var grayscale   = L.tileLayer(mbUrl, {id: 'mapbox.light', attribution: mbAttr}),
    		streets  = L.tileLayer(mbUrl, {id: 'mapbox.streets',   attribution: mbAttr});
    		comic  = L.tileLayer(mbUrl, {id: 'mapbox.comic',   attribution: mbAttr});
    		pencils  = L.tileLayer(mbUrl, {id: 'mapbox.pencils',   attribution: mbAttr});
    		outdoors  = L.tileLayer(mbUrl, {id: 'mapbox.outdoors',   attribution: mbAttr});
    		satellite  = L.tileLayer(mbUrl, {id: 'mapbox.satellite',   attribution: mbAttr});
    		run  = L.tileLayer(mbUrl, {id: 'mapbox.run-bike-hike',   attribution: mbAttr});


    	var baseLayers = {
    		"Grayscale": grayscale,
    		"Streets": streets,
    		"comic": comic,
    		"pencils": pencils,
    		"outdoors": outdoors,
    		"satellite": satellite,
    		"run-bike-hike": run,
    	};

    	var overlays = {
    		"Cities": cities
    	};

    	L.control.layers(baseLayers, overlays).addTo(map);
    	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
    		maxZoom: 20,
    		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
    			'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
    			'Imagery © <a href="http://mapbox.com">Mapbox</a>',
    		id: 'mapbox.light'
    	}).addTo(map);

    	function getColor(d) {
        return d > 1000 ? '#800026' :
               d > 500  ? '#BD0026' :
               d > 200  ? '#E31A1C' :
               d > 100  ? '#FC4E2A' :
               d > 50   ? '#FD8D3C' :
               d > 20   ? '#FEB24C' :
               d > 10   ? '#FED976' :
                          '#FFEDA0';
    }
    	function style(feature) {
    	    return {
    	        // fillColor: getColor(feature.properties.density),
    	        weight: 2,
    	        opacity: 1,
    	        color: 'white',
    	        dashArray: '3',
    	        fillOpacity: 0
    	    };
    	}
    	function highlightFeature(e) {
    	    var layer = e.target;

    	    layer.setStyle({
    	        weight: 5,
    	        color: '#16f',
    	        dashArray: '',
    	        fillOpacity: 0.7
    	    });

    	    if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
    	        layer.bringToFront();
    	    }
    	    info.update(layer.feature.properties);
    	}
    	function resetHighlight(e) {
    	    geojson.resetStyle(e.target);
    	    info.update();
    	}
    	function zoomToFeature(e) {
    	    map.fitBounds(e.target.getBounds());
    	}
    	function onEachFeature(feature, layer) {
    	    layer.on({
    	        mouseover: highlightFeature,
    	        mouseout: resetHighlight,
    	        click: zoomToFeature
    	    });
    	}
    	var info = L.control();

    	info.onAdd = function (map) {
    	    this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
    	    this.update();
    	    return this._div;
    	};

    	// method that we will use to update the control based on feature properties passed
    	info.update = function (props) {
    	    this._div.innerHTML = '<h4>US Population Density</h4>' +  (props ?
    	        '<b>' + props.name + '</b><br />' + props.density + ' people / mi<sup>2</sup>'
    	        : 'Hover over a state');
    	};
    	var legend = L.control({position: 'bottomright'});

    	legend.onAdd = function (map) {

    	    var div = L.DomUtil.create('div', 'info legend'),
    	        grades = [0, 10, 20, 50, 100, 200, 500, 1000],
    	        labels = [];

    	    // loop through our density intervals and generate a label with a colored square for each interval
    	    for (var i = 0; i < grades.length; i++) {
    	        div.innerHTML +=
    	            '<i style="background:' + getColor(grades[i] + 1) + '"></i> ' +
    	            grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
    	    }

    	    return div;
    	};


    	geojson = L.geoJson(statesData, {
    	    style: style,
    	    onEachFeature: onEachFeature
    	}).addTo(map);
    	info.addTo(map);
    	legend.addTo(map);
      }



</script>
<script async defer src="http://api.windyty.com/v2.1/boot.js"></script> 
{% endblock %}
